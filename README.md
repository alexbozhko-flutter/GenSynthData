# Генератор синтетического корпуса инвойсов

## Назначение проекта

Данный проект представляет собой инструментарий для автоматической генерации тестового набора синтетических инвойсов в формате PDF на основе реальных данных. Созданный корпус будет содержать документы разных уровней сложности для систематического тестирования алгоритмов извлечения данных.

Основная цель - создание набора документов, который позволит оценивать эффективность различных подходов к обработке слабоструктурированных документов с контролируемой сложностью.

## Структура проекта

```
invoice-generator/
├── scripts/                       # Скрипты для разных этапов обработки
│   ├── __init__.py
│   ├── 01_data_preparation.py     # Анонимизация данных из БД
│   ├── 02_synthetic_generation.py # Дополнение синтетическими данными (опционально) 
│   ├── 03_pdf_generation.py       # Генерация PDF-документов
│   └── 04_corpus_validation.py    # Валидация и анализ корпуса
│
├── utils/                         # Утилиты для работы с данными и PDF
│   ├── __init__.py
│   ├── data_utils.py              # Функции для обработки данных
│   └── pdf_utils.py               # Функции для генерации PDF
│
├── templates/                     # Шаблоны для генерации PDF-документов
│   ├── basic/                     # Шаблоны базовой сложности
│   ├── standard/                  # Шаблоны стандартной сложности
│   ├── advanced/                  # Шаблоны повышенной сложности
│   └── complex/                   # Шаблоны высокой сложности
│
├── fonts/                         # Шрифты для генерации PDF-документов (для Windows)
│   └── README.txt                 # Инструкции по установке шрифтов
│
├── data/                          # Директории для данных
│   ├── base/                      # Исходные данные из БД
│   ├── anonymized/                # Анонимизированные данные
│   ├── sample/                    # Примеры реальных инвойсов для анализа
│   └── output/                    # Готовые PDF и их метаданные
│
├── config/                        # Конфигурационные файлы
│   ├── generation_config.json     # Параметры генерации
│   └── templates_config.json      # Настройки шаблонов
│
├── main.py                        # Главный скрипт для запуска всего процесса
├── requirements.txt               # Зависимости проекта
├── Database/                      # Файлы базы данных
│   └── scheme.ddl                 # Полная SQL-схема базы данных со всеми таблицами
│
└── README.md                      # Документация проекта
```

## Классификация документов по сложности

Генератор создает 4 типа документов с различной степенью сложности обработки:

### 1. Базовый уровень сложности
- Четкая структура с явными разделами
- Однозначная терминология
- Один язык
- Стандартное представление чисел и дат

### 2. Стандартный уровень сложности
- Умеренно структурированные документы
- Незначительные вариации в шаблонах
- Преимущественно один язык с некоторыми иностранными терминами
- Стандартные форматы с незначительными отклонениями

### 3. Повышенный уровень сложности
- Более сложная структура с вариативностью
- Частичная многоязычность
- Вариативное представление чисел и дат
- Умеренная неоднозначность терминологии

### 4. Высокий уровень сложности
- Нерегулярная структура с существенными вариациями
- Активное использование нескольких языков
- Разнообразные форматы данных
- Высокая степень неоднозначности терминологии

## Пошаговый план реализации

### Этап 1: Подготовка инфраструктуры проекта
- Создание структуры директорий и файлов
- Настройка виртуального окружения
- Установка необходимых зависимостей
- Создание базовых конфигурационных файлов

### Этап 2: Подготовка и анонимизация данных из БД
- Экспорт данных из SQL базы данных в CSV или другой формат
- Анонимизация данных о производителях, коллекциях и продуктах
- Сохранение анонимизированных данных для дальнейшего использования

### Этап 3: Разработка шаблонов документов
- Создание HTML/CSS шаблонов для PDF-документов разной сложности
- Разработка логики для вариативного представления одних и тех же данных
- Определение форматирования для разных уровней сложности

### Этап 4: Генерация PDF-документов
- Разработка функций для создания PDF на основе шаблонов
- Генерация документов различных уровней сложности
- Создание метаданных для каждого документа
- Организация файлов по директориям

### Этап 5: Валидация и анализ корпуса
- Проверка соответствия документов заявленным уровням сложности
- Статистический анализ характеристик корпуса
- Визуализация распределения документов по характеристикам
- Создание каталога корпуса с метаданными

## Работа со шрифтами

### macOS
На macOS автоматически используются системные шрифты с поддержкой кириллицы.

### Другие операционные системы
Для корректной работы с кириллицей при генерации PDF-документов на других ОС может потребоваться установка дополнительных шрифтов. Инструкции по установке находятся в директории `fonts/`.

## Технические требования

- Python 3.8 или выше
- Основные зависимости:
  - pandas, numpy - для работы с данными
  - faker - для анонимизации данных
  - reportlab/fpdf - для создания PDF-документов
  - matplotlib, seaborn - для визуализации результатов
  - psycopg2/SQLAlchemy - для работы с базой данных

## Использование проекта

1. Клонировать репозиторий
2. Установить зависимости:
   ```bash
   pip install -r requirements.txt
   ```
3. Настроить конфигурацию в файлах директории `config/`
4. Запустить полный процесс генерации:
   ```bash
   python main.py
   ```
   
   Или запустить отдельные этапы:
   ```bash
   python scripts/01_data_preparation.py
   python scripts/02_synthetic_generation.py
   python scripts/03_pdf_generation.py
   python scripts/04_corpus_validation.py
   ```
5. Результаты будут доступны в директории `data/output/`

## Статистика исходных данных

- Количество производителей: 93
- Количество коллекций: 595
- Количество приходных накладных: 188
- Минимальное количество товаров в накладной: 1
- Максимальное количество товаров в накладной: 223
- Среднее количество товаров в накладной: 29.90

Эти данные используются как основа для генерации тестового корпуса инвойсов, обеспечивая реалистичные распределения и взаимосвязи между сущностями.

## Примеры реальных документов

В директории `data/sample/` размещены примеры реальных инвойсов, которые используются как эталонные образцы для генерации синтетических документов. Эти документы служат основой для:

- Анализа типичной структуры инвойсов
- Определения характерных элементов оформления
- Выявления вариативности в представлении данных
- Калибровки уровней сложности генерируемых документов

На основе анализа этих документов настраиваются параметры генерации и создаются шаблоны различной сложности.